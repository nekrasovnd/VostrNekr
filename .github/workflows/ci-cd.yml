name: CI/CD Pipeline

on:
  push:
    branches: [ main, feature/* ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Create basic HTML test
      run: |
        # Simple test to check if HTML file exists and is valid
        if [ ! -f "index.html" ]; then
          echo "❌ index.html not found"
          exit 1
        fi
        
        # Check if HTML contains basic calculator structure
        if ! grep -q "calculator" index.html; then
          echo "❌ Calculator structure not found in HTML"
          exit 1
        fi
        
        echo "✅ HTML structure test passed"
        
    - name: Validate JavaScript syntax
      run: |
        # Check if JavaScript files have basic syntax
        if [ -f "js/calculator.js" ]; then
          node -c js/calculator.js
          echo "✅ JavaScript syntax validation passed"
        else
          echo "❌ calculator.js not found"
          exit 1
        fi
        
    - name: Generate Doxygen documentation
      run: |
        sudo apt-get update
        sudo apt-get install -y doxygen graphviz
        doxygen --version
        doxygen Doxyfile
        echo "✅ Documentation generated"
        
    - name: Upload documentation artifact
      uses: actions/upload-artifact@v4
      with:
        name: doxygen-docs
        path: docs/html/
        retention-days: 7
        
  deploy-docs:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Generate and deploy documentation
      run: |
        sudo apt-get install -y doxygen graphviz
        doxygen Doxyfile
        echo "📚 Documentation would be deployed here in real scenario"
